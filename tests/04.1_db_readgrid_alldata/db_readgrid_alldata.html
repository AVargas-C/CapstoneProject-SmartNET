<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Database Overview</title>
<style>
  body { font-family: Arial, sans-serif; }
  table { width: 100%; border-collapse: collapse; }
  th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
  th { background-color: #f2f2f2; }
</style>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
<script>
  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyCnfqYtDnf95RXQvsele6IPmZtUpNhpSPQ",
    authDomain: "reto-estadioazteca.firebaseapp.com",
    projectId: "reto-estadioazteca",
    storageBucket: "reto-estadioazteca.appspot.com",
    messagingSenderId: "378312513144",
    appId: "1:378312513144:web:1c80ba54d21c63529c3f8d"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();
  console.log("Firebase app initialized successfully.");
  
</script>
</head>
<body>
<h1>Database Overview</h1>
<table id="data-table">
  <thead>
    <tr>
      <th>Palco</th>
      <th>Tap</th>
      <th>Estado de Pago</th>
      <th>Estado de Servicio</th>
      <th>Lecturas Ambientales</th>
      <th>Lecturas Eléctricas</th>
    </tr>
  </thead>
  <tbody>
    <!-- Data rows will be inserted here by JavaScript -->
  </tbody>
</table>

<script>
  function loadData() {
    const ref = database.ref('/'); // Adjust this path to where your data is stored within Firebase
    ref.on('value', (snapshot) => {
      const data = snapshot.val();
      populateTable(data);
    }, (error) => {
      console.error("Error reading data: " + error.code);
    });
  }

  function populateTable(data) {
    const table = document.getElementById('data-table').getElementsByTagName('tbody')[0];
    table.innerHTML = ''; // Clear existing entries

    Object.keys(data).forEach((key, index) => {
      const palco = data[key];
      const row = table.insertRow();
      row.insertCell(0).textContent = `/palco:${key.split(':')[1]}`;
      row.insertCell(1).textContent = `/tap: ${palco.tap}`;
      row.insertCell(2).textContent = palco.estado_pago ? 'Pagado' : 'No pagado';
      row.insertCell(3).textContent = palco.estado_servicio ? 'Activo' : 'Inactivo';

      // Handle Lecturas Ambientales
      let ambientReadings = [];
      if (palco.lecturas_ambientales) {
        Object.keys(palco.lecturas_ambientales).forEach(id => {
          const reading = palco.lecturas_ambientales[id];
          ambientReadings.push(`CO2: ${reading.co2} ppm, Temp: ${reading.temperatura}°C, Presencia: ${reading.presencia ? 'Yes' : 'No'}, Timestamp: ${reading.timestamp}`);
        });
      }
      row.insertCell(4).textContent = ambientReadings.join('; ');

      // Handle Lecturas Electricas
      let electricReadings = [];
      if (palco.lecturas_electricas) {
        Object.keys(palco.lecturas_electricas).forEach(id => {
          const reading = palco.lecturas_electricas[id];
          electricReadings.push(`Voltage: ${reading.voltage}V, Corriente: ${reading.corriente}A, Timestamp: ${reading.timestamp}`);
        });
      }
      row.insertCell(5).textContent = electricReadings.join('; ');
    });
  }

  window.onload = loadData;
</script>

</body>
</html>